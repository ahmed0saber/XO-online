<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>online Tic Tac Toe</title>
    <style>
      body{
        margin: 0;
        padding: 0;
        width: 300px;
        height: 407px;
        background-color: #EEE;
        overflow: hidden;
        overflow-y: auto;
      }
      #div1{
        min-height: 450px;
        margin: auto;
        text-align: center;
      }
      #back{
        height: 30px;
        float: left;
        margin: 10px;
      }
      #header{
        background-color: #33F;
        height: 52px;
      }
      input{
        height: 40px;
        width: 225px;
        margin: 10px;
        border: 2px solid #117;
        border-radius: 10px;
        padding: 5px;
        font-size: 18px;
        font-family: Times New Roman;
        outline: none;
      }
      .name{
        width: 110px;
        margin: 10px 0 10px 0;
      }
      #btn{
        width: 100px;
        margin-bottom: 5px;
      }
      #p1{
        font-size: 25px;
        font-family: Times New Roman;
        padding: 0;
        margin: 15px;
      }
      .errors{
        color: red;
        margin: 0;
        width: 225px;
        margin: auto;
        text-align: left;
        font-size: 14px;
      }
      .wrong{
        border-color: red;
        outline-color: red;
      }
      .right{
        border-color: green;
        outline-color: green;
      }
    </style>
  </head>
  <body>
    <div id="div1">
      {% if request.path == '/accounts/signup/game/' %} 
      <div id="header">
        <a href="{% url 'app:home' %}"><button id="back">Back</button></a>
      </div>
      {% endif %}
      <p id="p1">Create new account</p>
      <form action="" method="POST">
        {% csrf_token %}
        <input class="name" type="text" placeholder="First name" name="first_name">
        <input class="name" type="text" placeholder="Last name" name="last_name">
        <input id='email' type="email" placeholder="Email" name="email">
        <div class='errors' id='email_errors'></div>
        {{form.email.errors}}
        <input id='password1' type="password" placeholder="Password" name="password1">
        <div class='errors' id='pass_errors'></div>
        {{form.password1.errors}}
        <input id='password2' type="password" placeholder="Confirm password" name="password2">
        <div class='errors' id='pass2_errors'></div>
        {{form.password2.errors}}
        <input type="submit" id="btn" value="sign up">

      </form>
      <p>Already have account ?! <a href="{% url 'accounts:login' next%}">Log in</a></p>
    </div>
    <script>
      let email = document.getElementById('email')
      email.oninput = async ()=>{
        if (email.value == ''){
          email.classList = ''
          document.getElementById('email_errors').innerHTML = ''
          return
        }
        
        let res = await fetch(`/accounts/api/check_email/?email=${email.value}`)
        if (res.ok){
          email.classList = 'right'
          document.getElementById('email_errors').innerHTML = ''
        }else{
          console.clear()
          email.classList = 'wrong'
          res = await res.json()
          document.getElementById('email_errors').innerHTML ='' 
          for (err of res.details){
            document.getElementById('email_errors').innerHTML += `<p class='errors'>${err}</p>` 
          }
        }
      }

      let password = document.getElementById('password1')
      password.oninput = async ()=>{
        if (password.value == ''){
          password.classList = ''
          document.getElementById('pass_errors').innerHTML = ''
          return
        }
        let res = await fetch(`/accounts/api/check_password/?password=${password.value}`)
        if (res.ok){
          password.classList = 'right'
          document.getElementById('pass_errors').innerHTML = ''
        }else{
          console.clear()
          password.classList = 'wrong'
          res = await res.json()
          document.getElementById('pass_errors').innerHTML = '' 
          for (err of res.details){
            document.getElementById('pass_errors').innerHTML += `<p class='errors'>${err}</p>` 
          }
        }
      }

      let password2 = document.getElementById('password2')
      password2.oninput = ()=>{
        if (password2.value == password.value){
          password2.classList = 'right'
          document.getElementById('pass2_errors').innerHTML = ''
        }else{
          password2.classList = 'wrong'
          document.getElementById('pass2_errors').innerHTML = 'Two passwords must be the same' 
        }
      }
    </script>
  </body>
</html>
